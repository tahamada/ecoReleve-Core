<?php	include_once '../../lib/Cake/Model/ConnectionManager.php';	include_once 'AppController.php';	App::uses('Model', 'Model');	App::uses('AppModel', 'Model');	App::uses('CartoModel', 'Model');	App::uses('HttpSocket', 'Network/Http');		define("base", "narc_ereleve");	define("cache_time",3600);	class CartoController extends AppController{				var $helpers = array('Xml', 'Text','form','html','cache');		public $components = array('RequestHandler');		public $cacheAction = array(						'station_get' => cache_time					);		var $stations;		var $filename;						//get station for a datatable js can be filtered by protocoles and other param		function station_get(){				ini_set('memory_limit', '7000M');			$find=1;			$debug="";			$zoom=0;			$table_name="TStations"; //if proto name not set			$place="";			$region="";			$idate="";			$tsearch="";			$clus="no";			$format="json";			$layout="json";						$ModelName="CartoModel"; //for the array returned by find			$HttpSocket = new HttpSocket();						$model_proto=new CartoModel();			/** getting filters parameters for the url of station get **/			if(isset($this->params['url']['id_proto']) && $this->params['url']['id_proto']!=""){				$id_proto=$this->params['url']['id_proto'];			}						if(isset($this->params['url']['taxonsearch']) && $this->params['url']['taxonsearch']!=""){				$tsearch=$this->params['url']['taxonsearch'];			}						if(isset($this->params['url']['place']) && $this->params['url']['place']!=""){				$place=$this->params['url']['place'];			}						if(isset($this->params['url']['region']) && $this->params['url']['region']!=""){				$region=$this->params['url']['region'];			}			if(isset($this->params['url']['idate']) && $this->params['url']['idate']!=""){				$idate=$this->params['url']['idate'];			}						if(isset($this->params['url']['sSearch']) && $this->params['url']['sSearch']!=""){				$search=$this->params['url']['sSearch'];			}			/**___________________________________________________**/								//zoom parameter			if(isset($this->params['url']['zoom']) && $this->params['url']['zoom']!=""){				$zoom=$this->params['url']['zoom'];			}						//cluster parameter			if(isset($this->params['url']['cluster']) && $this->params['url']['cluster']!=""){				$clus=$this->params['url']['cluster'];				}								//post httprequest for get the stations				$results = $HttpSocket->post("http://localhost:81/html/cake/station/get?id_proto=$id_proto&place=$place&region=$region&idate=$idate&taxonsearch=$tsearch&to_carto=yes");			$station = json_decode($results->body,true);				$this->set("find",$find);			if($clus=="yes"){				$stations_marquers_clustered=$model_proto->cluster($station,20,$zoom);				$this->set("table",$stations_marquers_clustered);							}				else					$this->set("table",$station);			$this->set("ModelName",$ModelName);			$this->set("debug",$debug); 			$this->RequestHandler->respondAs($format);			$this->viewPath .= '/json';			$this->layout="json";			$this->layoutPath = $layout;			}	}	?>	